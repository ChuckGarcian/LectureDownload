(()=>{"use strict";const e=JSON.parse('{"$":"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"}');fetch("http://worldtimeapi.org/api/timezone/America/Chicago").then((function(e){return e.json()})).then((function(e){const t=e.datetime.substring(0,10);console.log(t),"2023-05-11"!==t?console.log("not equal"):"2023-05-11"===t&&console.log("equal!")}));var t=[];const o=new Set;function n(e){const t=Array.isArray(e)?[]:{};for(let o in e){const a=e[o];t[o]="object"==typeof a&&null!==a?n(a):a}return t}chrome.runtime.onMessage.addListener((function(e,t,o){if("getHTML"==e.message)return chrome.scripting.executeScript({target:{tabId:e.tabId},function:function(){const e=Array.from(document.querySelectorAll("a")),t=document.getElementsByTagName("span"),o=e.map((e=>e.href)).filter((e=>e.startsWith("https://lecturecapture.la.utexas.edu")));for(var n=[],a=0;a<o.length;a++)n.push({link:o[a],title:t[a].textContent,captionURL:null});chrome.runtime.sendMessage({message:"extractedLinks",extractedData:n})}}),!0})),chrome.runtime.onMessage.addListener((function(e,o,a){"extractedLinks"===e.message&&(console.log(t),console.log(e.extractedData),t=n(e.extractedData),console.log(e.extractedData),console.log(t),c())}));var a=0,s=[];function c(){if(0===t.length){console.log("DONE");for(var n=0;n<l.length;n++)s.push({videoURL:l[n].url,title:l[n].title,captionURL:i[n]});return void async function(t){const o={personalizations:[{to:[{email:"chuckgarcian@gmail.com"}]}],from:{email:"chuckgarcian@gmail.com"},subject:"Your JSON data",content:[{type:"text/html",value:"\n  <pre>\n  This is your JSON data.\n  </pre>\n"}],attachments:[{content:btoa(t),filename:"data.json",type:"application/json",disposition:"attachment"}]},n=await fetch("https://api.sendgrid.com/v3/mail/send",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.$}`},body:JSON.stringify(o)});n.ok?console.log("Email sent successfully"):console.error("Failed to send email:",await n.text())}(JSON.stringify(s))}const a=t[0].link;chrome.tabs.create({url:a,active:!1},(function(e){o.add(e.id)}))}var i=[];chrome.webRequest.onBeforeRequest.addListener((function(e){o.has(e.tabId)&&e.url.includes("chunklist_")?(console.log("Computed Computed!"),l.push({url:e.url,title:t[0].title}),console.log(l),a+=1):e.url.includes("caption_proxy")&&(console.log("CAPTION_URL",e.url),i.push(e.url))}),{urls:["<all_urls>"]});var l=[];chrome.tabs.onUpdated.addListener((function(e,n,s){"complete"==n.status&&chrome.tabs.get(e,(function(n){setTimeout((function(){"complete"===n.status&&"loading"!=n.status&&o.has(e)&&(console.log("Tab "+e+" has finished loading"),console.log(a),chrome.tabs.remove(e),t.shift(),c(),o.delete(e))}),1500)}))}))})();